[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Purchase Receipt", 
  "modified": "2018-12-02 21:31:30.538195", 
  "name": "Purchase Receipt-Client", 
  "script": "cur_frm.add_fetch('tipo_comprobante', 'codigo_tipo_comprobante', 'codigo_tipo_comprobante');\ncur_frm.add_fetch('tipo_operacion', 'codigo_tipos_operacion', 'codigo_tipo_operacion');\nfunction filter_operacion(frm, cdt, cdn){\n\tcur_frm.set_query(\"tipo_operacion\", function(){\n\t\treturn {\n\t\t\t\"filters\": [\n\t\t\t\t[\"Tipos de Operaciones\", \"codigo_tipos_operacion\", \"in\", [\"02\", \"04\", \"06\"]]]\n\t\t};\n\t});\n}\nfunction filter_comprobantes(frm, cdt, cdn){\n\tcur_frm.set_query(\"tipo_comprobante\", function(){\n\t\treturn {\n\t\t\t\"filters\": [\n\t\t\t\t[\"Tipos de Comprobante\", \"codigo_tipo_comprobante\", \"in\", [\"31\"]]]\n\t\t};\n\t});\n}\nfrappe.ui.form.on(\"Purchase Receipt\", {\n\tonload: function(frm, cdt, cdn){\n\t\tfilter_operacion(frm, cdt, cdn);\n\t\tfilter_comprobantes(frm, cdt, cdn);\n\t}\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Supplier", 
  "modified": "2018-12-24 15:44:07.536995", 
  "name": "Supplier-Client", 
  "script": "cur_frm.add_fetch('nombre_tipo_documento', 'codigo_tipo_documento', 'codigo_tipo_documento');\ncur_frm.add_fetch('nombre_tipo_transporte', 'codigo_tipo_transporte', 'codigo_tipo_transporte');", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Company", 
  "modified": "2018-11-27 17:02:53.846817", 
  "name": "Company-Client", 
  "script": "cur_frm.add_fetch('tipo_documento_identidad', 'codigo_tipo_documento', 'codigo_tipo_documento');\ncur_frm.add_fetch('catalogo_existencias', 'codigo_catalogo', 'codigo_catalogo_existencias');", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Customer", 
  "modified": "2018-10-23 16:30:18.202097", 
  "name": "Customer-Client", 
  "script": "cur_frm.add_fetch('tipo_documento_identidad', 'codigo_tipo_documento', 'codigo_tipo_documento');", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Purchase Invoice", 
  "modified": "2018-11-18 12:04:12.755389", 
  "name": "Purchase Invoice-Client", 
  "script": "cur_frm.add_fetch('tipo_comprobante', 'codigo_tipo_comprobante', 'codigo_comprobante');\ncur_frm.add_fetch('tipo_comprobante_proveedor', 'codigo_tipo_comprobante', 'codigo_comprobante_proveedor');\ncur_frm.add_fetch('supplier', 'codigo_tipo_documento', 'codigo_tipo_documento');\ncur_frm.add_fetch('supplier', 'nombre_tipo_documento', 'tipo_documento_identidad');\ncur_frm.add_fetch('tipo_nota_debito', 'codigo_notas_debito', 'codigo_nota_debito');\nfrappe.ui.form.on(\"Purchase Invoice\", {\n\tsupplier: function(frm, cdt, cdn) {\n\t\tget_document_series(frm, cdt, cdn);\n\t\tif (frm.doc.codigo_tipo_documento){\n\t\t\tfrappe.call({\n\t\t\t\ttype: \"GET\",\n\t\t\t\tmethod: \"nubefact_integration.nubefact_integration.doctype.tipos_de_transaccion_sunat.tipos_de_transaccion_sunat.get_tipo_transaccion_compras\",\n\t\t\t\targs: {\n\t\t\t\t\tsupplier: frm.doc.supplier\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"tipo_transaccion_sunat\", r.message.descripcion);\n\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"codigo_transaccion_sunat\", r.message.codigo);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse {\n\t\t\tfrappe.model.set_value(cdt, cdn, \"tipo_transaccion_sunat\", null);\n\t\t\tfrappe.model.set_value(cdt, cdn, \"codigo_transaccion_sunat\", null);\n\t\t}\n\t}\n});\nfrappe.ui.form.on(\"Purchase Invoice\", {\n\tcontingencia: function(frm, cdt, cdn) {\n\t\tget_document_series(frm, cdt, cdn);\n\t}\n});\nfrappe.ui.form.on(\"Purchase Invoice\", {\n\tis_return: function(frm, cdt, cdn) {\n\t\tget_document_series(frm, cdt, cdn);\n\t}\n});\nfrappe.ui.form.on(\"Purchase Invoice\", {\n\ttipo_comprobante_proveedor: function(frm, cdt, cdn) {\n\t\tget_document_series(frm, cdt, cdn);\n\t}\n});\nfrappe.ui.form.on('Purchase Invoice', {\n    validate: function(frm, cdt, cdn) {\n    \tif (frm.doc.__islocal != 1){\n    \t\tif (frm.doc.is_return == 1){\n    \t\t\tif (frm.doc.estado_sunat == null){\n\t\t    \t\tfrappe.call({\n\t\t\t\t\t\tmethod: \"nubefact_integration.nubefact_integration.facturacion_electronica.send_document\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t'invoice': frm.doc.name,\n\t\t\t\t\t\t\t'doctype': frm.doc.doctype\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function (data) {\n\t\t\t\t\t\t\tconsole.log(data)\n\t\t\t\t\t\t\tif (data != \"\"){\n\t\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"estado_sunat\", (data.message.aceptada_por_sunat) ? (\"Aceptado\") : (\"Rechazado\"));\n\t\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"respuesta_sunat\", data.message.sunat_descripcion);\n\t\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"codigo_qr_sunat\", data.message.cadena_para_codigo_qr);\n\t\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"codigo_barras_sunat\", data.message.codigo_de_barras);\n\t\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"codigo_hash_sunat\", data.message.codigo_hash);\n\t\t\t\t\t\t\t}\n\t\t\t\t        }\n\t\t\t\t\t})\n\t\t\t\t}\n    \t\t}\n    \t}\n    }\n});\nfrappe.ui.form.on(\"Purchase Invoice\", {\n\tis_return: function(frm){\n\t\tcur_frm.set_query(\"tipo_comprobante_proveedor\", function(){\n\t\t\treturn {\n\t\t\t\t\"filters\": [\n\t\t\t\t\t[\"Tipos de Comprobante\", \"nombre_tipo_comprobante\", \"in\", [\"Boleta de Venta\", \"Factura\"]]\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\t}\n});\nfunction get_document_series(frm, cdt, cdn) {\n\tfrappe.call({\n\t\ttype: \"GET\",\n\t\tmethod: \"nubefact_integration.nubefact_integration.doctype.configuracion.configuracion.get_doc_serie\",\n\t\targs: {\n\t\t\tdoctype: frm.doc.doctype,\n\t\t\tis_return: frm.doc.is_return ? \"1\" : \"0\",\n\t\t\tcontingencia: frm.doc.contingencia ? \"1\" : \"0\",\n\t\t\tcodigo_comprobante: frm.doc.codigo_comprobante_proveedor\n\t\t},\n\t\tcallback: function(r) {\n\t\t\tfrappe.model.set_value(cdt, cdn, \"tipo_comprobante\", r.message.descripcion);\n\t\t\tfrappe.model.set_value(cdt, cdn, \"codigo_comprobante\", r.message.codigo);\n\t\t\tfrm.set_df_property(\"naming_series\", \"options\", r.message.series);\n\t\t}\n\t});\n};\nfrappe.ui.form.on(\"Sales Invoice\", {\n\tbefore_cancel: function(frm, cdt, cdn){\n\t\tif (frm.doc.codigo_comprobante == \"8\"){\n\t\t\tif (frappe.datetime.get_day_diff(frm.doc.posting_date, frappe.datetime.get_today()) < 7 && frm.doc.estado_anulacion != \"En proceso\"){\n\t\t\t\treturn new Promise(function(resolve, reject) {\n\t\t\t\t\tfrappe.prompt([\n\t\t\t\t\t\t{'fieldname': 'motivo', 'fieldtype': 'Data', 'label': 'Motivo de la cancelacion', 'reqd': 1}  \n\t\t\t\t\t],\n\t\t\t\t\tfunction(values){\n\t\t\t\t\t\tresolve(values);\n\t\t\t\t\t},\n\t\t\t\t\t'Cancelacion de Comprobante',\n\t\t\t\t\t'Anular'\n\t\t\t\t\t)\n\t\t\t\t}).then(function (values){\n\t\t\t\t\tfrappe.validated = false;\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod: \"nubefact_integration.nubefact_integration.facturacion_electronica.cancel_document\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t'invoice': frm.docname,\n\t\t\t\t\t\t\t'doctype': frm.doctype,\n\t\t\t\t\t\t\t'motivo': values.motivo\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function (data) {\n\t\t\t\t\t\t\tconsole.log(data)\n\t\t\t\t\t\t\tfrappe.msgprint(\"<b>Esperando respuesta de SUNAT</b>\", 'Cancelaci\u00f3n');\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfrappe.validated = false;\n\t\t\t\tfrappe.msgprint(\"<b>Documento no se puede anular o esta en proceso de anulaci\u00f3n</b>\", 'Cancelaci\u00f3n');\n\t\t\t}\n\t\t}\n\t}\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Sales Invoice", 
  "modified": "2018-11-15 18:27:09.395631", 
  "name": "Sales Invoice-Client", 
  "script": "cur_frm.add_fetch('customer', 'codigo_tipo_documento', 'codigo_tipo_documento');\ncur_frm.add_fetch('customer', 'tipo_documento_identidad', 'tipo_documento_identidad');\ncur_frm.add_fetch('tipo_transaccion_sunat', 'codigo_tipo_transaccion', 'codigo_transaccion_sunat');\ncur_frm.add_fetch('tipo_nota_credito', 'codigo_notas_credito', 'codigo_nota_credito');\nfunction get_document_series(frm, cdt, cdn){\n\tfrappe.call({\n\t\ttype: \"GET\",\n\t\tmethod: \"nubefact_integration.nubefact_integration.doctype.configuracion.configuracion.get_doc_serie\",\n\t\targs: {\n\t\t\tdoctype: frm.doc.doctype,\n\t\t\tis_return: frm.doc.is_return ? \"1\" : \"0\",\n\t\t\tcontingencia: frm.doc.contingencia ? \"1\" : \"0\",\n\t\t\tcodigo_tipo_documento: frm.doc.codigo_tipo_documento\n\t\t},\n\t\tcallback: function(r) {\n\t\t\tfrappe.model.set_value(cdt, cdn, \"tipo_comprobante\", r.message.descripcion);\n\t\t\tfrappe.model.set_value(cdt, cdn, \"codigo_comprobante\", r.message.codigo);\n\t\t\tfrm.set_df_property(\"naming_series\", \"options\", r.message.series);\n\t\t}\n\t});\n}\nfunction get_document_transaction(frm, cdt, cdn){\n\tfrappe.call({\n\t\ttype: \"GET\",\n\t\tmethod: \"nubefact_integration.nubefact_integration.doctype.tipos_de_transaccion_sunat.tipos_de_transaccion_sunat.get_tipo_transaccion\",\n\t\targs: {\n\t\t\tcustomer: frm.doc.customer,\n\t\t\tis_return: frm.doc.is_return ? \"1\" : \"0\"\n\t\t},\n\t\tcallback: function(r) {\n\t\t\tfrappe.model.set_value(cdt, cdn, \"tipo_transaccion_sunat\", r.message.descripcion);\n\t\t\tfrappe.model.set_value(cdt, cdn, \"codigo_transaccion_sunat\", r.message.codigo);\n\t\t}\n\t});\n}\nfrappe.ui.form.on(\"Sales Invoice\", {\n\tcustomer: function(frm, cdt, cdn) {\n\t\tif (frm.doc.codigo_tipo_documento){\n\t\t\tget_document_series(frm, cdt, cdn);\n\t\t\tget_document_transaction(frm, cdt, cdn);\n\t\t}\n\t\telse {\n\t\t\tfrappe.model.set_value(cdt, cdn, \"tipo_comprobante\", null);\n\t\t\tfrappe.model.set_value(cdt, cdn, \"codigo_comprobante\", null);\n\t\t\tfrappe.model.set_value(cdt, cdn, \"tipo_transaccion_sunat\", null);\n\t\t\tfrappe.model.set_value(cdt, cdn, \"codigo_transaccion_sunat\", null);\n\t\t}\n\t}\n});\nfrappe.ui.form.on(\"Sales Invoice\", {\n\tcontingencia: function(frm, cdt, cdn) {\n\t\tif (frm.doc.codigo_tipo_documento){\n\t\t\tget_document_series(frm, cdt, cdn);\n\t\t}\n\t}\n});\nfrappe.ui.form.on(\"Sales Invoice\", {\n\tis_return: function(frm, cdt, cdn) {\n\t\tif (frm.doc.codigo_tipo_documento){\n\t\t\tget_document_series(frm, cdt, cdn);\n\t\t}\n\t}\t\n});\nfrappe.ui.form.on('Sales Invoice', {\n    validate: function(frm, cdt, cdn) {\n    \tif (frm.doc.__islocal != 1){\n    \t\tif (frm.doc.estado_sunat == null || frm.doc.is_return == 1){\n\t    \t\tfrappe.call({\n\t\t\t\t\tmethod: \"nubefact_integration.nubefact_integration.facturacion_electronica.send_document\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\t'invoice': frm.doc.name,\n\t\t\t\t\t\t'doctype': frm.doc.doctype\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function (data) {\n\t\t\t\t\t\tconsole.log(data)\n\t\t\t\t\t\tif (data != \"\"){\n\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"estado_sunat\", (data.message.key != \"\") ? (\"Aceptado\") : (\"Rechazado\"));\n\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"respuesta_sunat\", data.message.sunat_descripcion);\n\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"codigo_qr_sunat\", data.message.cadena_para_codigo_qr);\n\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"codigo_barras_sunat\", data.message.codigo_de_barras);\n\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"codigo_hash_sunat\", data.message.codigo_hash);\n\t\t\t\t\t\t}\n\t\t\t        }\n\t\t\t\t})\n\t\t\t}\n    \t}\n    }\n});\nfrappe.ui.form.on('Sales Invoice', {\n\trefresh: function(frm, cdt, cdn){\n\t\tif (frm.doc.is_return == 1){\n\t\t\tget_document_series(frm, cdt, cdn);\n\t\t}\n\t}\n});\nfrappe.ui.form.on(\"Sales Invoice\", {\n\tbefore_cancel: function(frm, cdt, cdn){\n\t\tif (frappe.datetime.get_day_diff(frm.doc.posting_date, frappe.datetime.get_today()) < 7 && frm.doc.estado_anulacion != \"En proceso\"){\n\t\t\treturn new Promise(function(resolve, reject) {\n\t\t\t\tfrappe.prompt([\n\t\t\t\t\t{'fieldname': 'motivo', 'fieldtype': 'Data', 'label': 'Motivo de la cancelacion', 'reqd': 1}  \n\t\t\t\t],\n\t\t\t\tfunction(values){\n\t\t\t\t\tresolve(values);\n\t\t\t\t},\n\t\t\t\t'Cancelacion de Comprobante',\n\t\t\t\t'Anular'\n\t\t\t\t)\n\t\t\t}).then(function (values){\n\t\t\t\tfrappe.validated = false;\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"nubefact_integration.nubefact_integration.facturacion_electronica.cancel_document\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\t'invoice': frm.docname,\n\t\t\t\t\t\t'doctype': frm.doctype,\n\t\t\t\t\t\t'motivo': values.motivo\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function (data) {\n\t\t\t\t\t\tconsole.log(data)\n\t\t\t\t\t\tfrappe.msgprint(\"<b>Esperando respuesta de SUNAT</b>\", 'Cancelaci\u00f3n');\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t});\n\t\t}\n\t\telse {\n\t\t\tfrappe.validated = false;\n\t\t\tfrappe.msgprint(\"<b>Documento no se puede anular o esta en proceso de anulaci\u00f3n</b>\", 'Cancelaci\u00f3n');\n\t\t}\n\t}\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Fees", 
  "modified": "2018-11-26 21:44:48.829413", 
  "name": "Fees-Client", 
  "script": "cur_frm.add_fetch('student', 'codigo_tipo_documento', 'codigo_tipo_documento');\ncur_frm.add_fetch('student', 'tipo_documento_identidad', 'tipo_documento_identidad');\ncur_frm.add_fetch('student', 'tax_id', 'tax_id');\ncur_frm.add_fetch('tipo_transaccion_sunat', 'codigo_tipo_transaccion', 'codigo_transaccion_sunat');\ncur_frm.add_fetch('tipo_nota_credito', 'codigo_notas_credito', 'codigo_nota_credito');\nfunction get_document_series(frm, cdt, cdn){\n\tfrappe.call({\n\t\ttype: \"GET\",\n\t\tmethod: \"nubefact_integration.nubefact_integration.doctype.configuracion.configuracion.get_doc_serie\",\n\t\targs: {\n\t\t\tdoctype: frm.doc.doctype,\n\t\t\tis_return: frm.doc.is_return ? \"1\" : \"0\",\n\t\t\tcontingencia: frm.doc.contingencia ? \"1\" : \"0\",\n\t\t\tcodigo_tipo_documento: frm.doc.codigo_tipo_documento\n\t\t},\n\t\tcallback: function(r) {\n\t\t\tfrappe.model.set_value(cdt, cdn, \"tipo_comprobante\", r.message.descripcion);\n\t\t\tfrappe.model.set_value(cdt, cdn, \"codigo_comprobante\", r.message.codigo);\n\t\t\tfrm.set_df_property(\"naming_series\", \"options\", r.message.series);\n\t\t}\n\t});\n}\nfunction get_document_transaction(frm, cdt, cdn){\n\tfrappe.call({\n\t\ttype: \"GET\",\n\t\tmethod: \"nubefact_integration.nubefact_integration.doctype.tipos_de_transaccion_sunat.tipos_de_transaccion_sunat.get_tipo_transaccion_fee\",\n\t\targs: {\n\t\t\tstudent: frm.doc.student,\n\t\t\tis_return: frm.doc.is_return ? \"1\" : \"0\"\n\t\t},\n\t\tcallback: function(r) {\n\t\t\tfrappe.model.set_value(cdt, cdn, \"tipo_transaccion_sunat\", r.message.descripcion);\n\t\t\tfrappe.model.set_value(cdt, cdn, \"codigo_transaccion_sunat\", r.message.codigo);\n\t\t}\n\t});\n}\nfrappe.ui.form.on(\"Fees\", {\n\tstudent: function(frm, cdt, cdn) {\n\t\tif (frm.doc.codigo_tipo_documento){\n\t\t\tget_document_series(frm, cdt, cdn);\n\t\t\tget_document_transaction(frm, cdt, cdn);\n\t\t}\n\t\telse {\n\t\t\tfrappe.model.set_value(cdt, cdn, \"tipo_comprobante\", null);\n\t\t\tfrappe.model.set_value(cdt, cdn, \"codigo_comprobante\", null);\n\t\t\tfrappe.model.set_value(cdt, cdn, \"tipo_transaccion_sunat\", null);\n\t\t\tfrappe.model.set_value(cdt, cdn, \"codigo_transaccion_sunat\", null);\n\t\t}\n\t}\n});\nfrappe.ui.form.on(\"Fees\", {\n\tcontingencia: function(frm, cdt, cdn) {\n\t\tif (frm.doc.codigo_tipo_documento){\n\t\t\tget_document_series(frm, cdt, cdn);\n\t\t}\n\t}\n});\nfrappe.ui.form.on(\"Fees\", {\n\tis_return: function(frm, cdt, cdn) {\n\t\tif (frm.doc.codigo_tipo_documento){\n\t\t\tget_document_series(frm, cdt, cdn);\n\t\t}\n\t}\t\n});\nfrappe.ui.form.on(\"Fees\", {\n\tfactura_de_venta: function(frm, cdt, cdn) {\n\t\tif (frm.doc.codigo_tipo_documento){\n\t\t\tif (frm.doc.factura_de_venta == \"1\"){\n\t\t\t\tfrappe.model.set_value(cdt, cdn, \"tipo_documento_identidad\", \"REGISTRO \u00daNICO DE CONTRIBUYENTES\");\n\t\t\t\tfrappe.model.set_value(cdt, cdn, \"codigo_tipo_documento\", \"6\");\n\t\t\t\tfrappe.model.set_value(cdt,cdn, \"tax_id\", \"\")\n\t\t\t}\n\t\t\telse{\n\t\t\t\tfrappe.model.set_value(cdt, cdn, \"tipo_documento_identidad\", \"DOCUMENTO NACIONAL DE IDENTIDAD (DNI)\");\n\t\t\t\tfrappe.model.set_value(cdt, cdn, \"codigo_tipo_documento\", \"1\");\n\t\t\t}\t\t\t\n\t\t\tget_document_series(frm, cdt, cdn);\n\t\t}\n\t}\t\n});\nfrappe.ui.form.on('Fees', {\n\trefresh: function(frm, cdt, cdn){\n\t\tif (frm.doc.is_return == 1){\n\t\t\tget_document_series(frm, cdt, cdn);\n\t\t}\n\t}\n});\nfrappe.ui.form.on('Fees', {\n\tvalidate: function(frm, cdt, cdn) {\n\t\tif (frm.doc.factura_de_venta == 1){\n\t\t\tif (typeof frm.doc.razon_social === 'undefined' || typeof frm.doc.tax_id === 'undefined' || typeof frm.doc.direccion === 'undefined'){\n\t\t\t\tfrappe.validated = false;\n\t\t\t}\n\t\t}\n\t\tif (frm.doc.__islocal != 1){\n\t\t\tif (frm.doc.estado_sunat == null || frm.doc.is_return == 1){\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"nubefact_integration.nubefact_integration.facturacion_electronica.send_document\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\t'invoice': frm.doc.name,\n\t\t\t\t\t\t'doctype': frm.doc.doctype\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function (data) {\n\t\t\t\t\t\tconsole.log(data)\n\t\t\t\t\t\tif (data != \"\"){\n\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"estado_sunat\", (data.message.key != \"\") ? (\"Aceptado\") : (\"Rechazado\"));\n\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"respuesta_sunat\", data.message.sunat_descripcion);\n\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"codigo_qr_sunat\", data.message.cadena_para_codigo_qr);\n\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"codigo_barras_sunat\", data.message.codigo_de_barras);\n\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"codigo_hash_sunat\", data.message.codigo_hash);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n});\nfrappe.ui.form.on(\"Fees\", {\n\tbefore_cancel: function(frm, cdt, cdn){\n\t\tif (frappe.datetime.get_day_diff(frm.doc.posting_date, frappe.datetime.get_today()) < 7 && frm.doc.estado_anulacion != \"En proceso\"){\n\t\t\treturn new Promise(function(resolve, reject) {\n\t\t\t\tfrappe.prompt([\n\t\t\t\t\t{'fieldname': 'motivo', 'fieldtype': 'Data', 'label': 'Motivo de la cancelacion', 'reqd': 1}  \n\t\t\t\t],\n\t\t\t\tfunction(values){\n\t\t\t\t\tresolve(values);\n\t\t\t\t},\n\t\t\t\t'Cancelacion de Comprobante',\n\t\t\t\t'Anular'\n\t\t\t\t)\n\t\t\t}).then(function (values){\n\t\t\t\tfrappe.validated = false;\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"nubefact_integration.nubefact_integration.facturacion_electronica.cancel_document\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\t'invoice': frm.docname,\n\t\t\t\t\t\t'doctype': frm.doctype,\n\t\t\t\t\t\t'motivo': values.motivo\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function (data) {\n\t\t\t\t\t\tconsole.log(data)\n\t\t\t\t\t\tfrappe.msgprint(\"<b>Esperando respuesta de SUNAT</b>\", 'Cancelaci\u00f3n');\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t});\n\t\t}\n\t\telse {\n\t\t\tfrappe.validated = false;\n\t\t\tfrappe.msgprint(\"<b>Documento no se puede anular o esta en proceso de anulaci\u00f3n</b>\", 'Cancelaci\u00f3n');\n\t\t}\n\t}\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Student", 
  "modified": "2018-11-22 16:31:36.767551", 
  "name": "Student-Client", 
  "script": "cur_frm.add_fetch('tipo_documento_identidad', 'codigo_tipo_documento', 'codigo_tipo_documento');", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Item", 
  "modified": "2018-11-27 11:59:51.952076", 
  "name": "Item-Client", 
  "script": "cur_frm.add_fetch('stock_uom', 'codigo_sunat', 'codigo_uom');\ncur_frm.add_fetch('tipo_existencia', 'codigo_tipos_existencia', 'codigo_tipo_existencia');", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Stock Entry", 
  "modified": "2018-12-02 21:07:46.369454", 
  "name": "Stock Entry-Client", 
  "script": "cur_frm.add_fetch('tipo_operacion', 'codigo_tipos_operacion', 'codigo_tipo_operacion');\nfunction filter_operacion(frm, cdt, cdn){\n\tif (frm.doc.purpose == \"Material Issue\"){\n\t\tcur_frm.set_query(\"tipo_operacion\", function(){\n\t\t\treturn {\n\t\t\t\t\"filters\": [\n\t\t\t\t\t[\"Tipos de Operaciones\", \"codigo_tipos_operacion\", \"in\", [\"12\", \"13\", \"14\", \"15\", \"28\"]]]\n\t\t\t}\n\t\t});\n\t}\n\telse {\n\t\tfrm.toggle_display(\"tipo_operacion\", false);\n\t\tfrm.toggle_display(\"codigo_tipo_operacion\", false);\n\t\tfrm.toggle_display(\"sb_sunat\", false);\n\t\tfrappe.model.set_value(cdt, cdn, \"codigo_tipo_operacion\", \"00\");\n\t}\n}\nfrappe.ui.form.on(\"Stock Entry\", {\n\tonload: function(frm, cdt, cdn){\n\t\tfilter_operacion(frm, cdt, cdn);\n\t}\n});\nfrappe.ui.form.on(\"Stock Entry\", {\n\tpurpose: function(frm, cdt, cdn){\n\t\tfilter_operacion(frm, cdt, cdn);\n\t}\n});\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Delivery Note", 
  "modified": "2018-12-25 23:06:57.999354", 
  "name": "Delivery Note-Client", 
  "script": "cur_frm.add_fetch('tipo_comprobante', 'codigo_tipo_comprobante', 'codigo_tipo_comprobante');\ncur_frm.add_fetch('tipo_operacion', 'codigo_tipos_operacion', 'codigo_tipo_operacion');\ncur_frm.add_fetch('customer', 'codigo_tipo_documento', 'codigo_tipo_documento');\ncur_frm.add_fetch('customer', 'tipo_documento_identidad', 'tipo_documento_identidad');\ncur_frm.add_fetch('motivo_traslado', 'codigo_motivo_traslado', 'codigo_motivo_traslado');\ncur_frm.add_fetch('tipo_transporte', 'codigo_tipo_transporte', 'codigo_tipo_transporte');\ncur_frm.add_fetch('transporter', 'nombre_tipo_transporte', 'tipo_transporte');\ncur_frm.add_fetch('transporter', 'codigo_tipo_transporte', 'codigo_tipo_transporte');\nfunction filter_operacion(frm, cdt, cdn){\n\tcur_frm.set_query(\"tipo_operacion\", function(){\n\t\treturn {\n\t\t\t\"filters\": [\n\t\t\t\t[\"Tipos de Operaciones\", \"codigo_tipos_operacion\", \"in\", [\"01\", \"03\", \"05\"]]]\n\t\t};\n\t});\n}\nfunction filter_comprobantes(frm, cdt, cdn){\n\tcur_frm.set_query(\"tipo_comprobante\", function(){\n\t\treturn {\n\t\t\t\"filters\": [\n\t\t\t\t[\"Tipos de Comprobante\", \"codigo_tipo_comprobante\", \"in\", [\"09\"]]]\n\t\t};\n\t});\n}\nfrappe.ui.form.on(\"Delivery Note\", {\n\tonload: function(frm, cdt, cdn){\n\t\tfilter_operacion(frm, cdt, cdn);\n\t\tfilter_comprobantes(frm, cdt, cdn);\n\t}\n});\nfunction get_document_series(frm, cdt, cdn){\n\tfrappe.call({\n\t\ttype: \"GET\",\n\t\tmethod: \"nubefact_integration.nubefact_integration.doctype.configuracion.configuracion.get_doc_serie\",\n\t\targs: {\n\t\t\tdoctype: frm.doc.doctype\n\t\t},\n\t\tcallback: function(r) {\n\t\t\tfrappe.model.set_value(cdt, cdn, \"tipo_comprobante\", r.message.descripcion);\n\t\t\tfrappe.model.set_value(cdt, cdn, \"codigo_tipo_comprobante\", r.message.codigo);\n\t\t\tfrm.set_df_property(\"naming_series\", \"options\", r.message.series);\n\t\t}\n\t});\n}\nfrappe.ui.form.on(\"Delivery Note\", {\n\tcustomer: function(frm, cdt, cdn) {\n\t\tif (frm.doc.codigo_tipo_documento){\n\t\t\tget_document_series(frm, cdt, cdn);\n\t\t}\n\t\telse {\n\t\t\tfrappe.model.set_value(cdt, cdn, \"tipo_comprobante\", null);\n\t\t\tfrappe.model.set_value(cdt, cdn, \"codigo_comprobante\", null);\n\t\t}\n\t}\n})\nfrappe.ui.form.on('Delivery Note', {\n\tvalidate: function(frm, cdt, cdn) {\n\t    console.log(frm.doc)\n\t\tif (frm.doc.__islocal != 1){\n\t\t\tif (frm.doc.estado_sunat == null){\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"nubefact_integration.nubefact_integration.facturacion_electronica.send_document\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\t'invoice': frm.doc.name,\n\t\t\t\t\t\t'doctype': frm.doc.doctype\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function (data) {\n\t\t\t\t\t\tconsole.log(data)\n\t\t\t\t\t\tif (data != \"\"){\n\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"estado_sunat\", (data.message.key != \"\") ? (\"Aceptado\") : (\"Rechazado\"));\n\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"respuesta_sunat\", data.message.sunat_descripcion);\n\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"codigo_qr_sunat\", data.message.cadena_para_codigo_qr);\n\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"codigo_barras_sunat\", data.message.codigo_de_barras);\n\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"codigo_hash_sunat\", data.message.codigo_hash);\n\t\t\t\t\t\t}\n\t\t\t        }\n\t\t\t\t})\n\t\t\t}\n    \t}\n    }\n});\nfrappe.ui.form.on(\"Delivery Note\", {\n\tbefore_cancel: function(frm, cdt, cdn){\n\t\tif (frappe.datetime.get_day_diff(frm.doc.posting_date, frappe.datetime.get_today()) < 7 && frm.doc.estado_anulacion != \"En proceso\"){\n\t\t\treturn new Promise(function(resolve, reject) {\n\t\t\t\tfrappe.prompt([\n\t\t\t\t\t{'fieldname': 'motivo', 'fieldtype': 'Data', 'label': 'Motivo de la cancelacion', 'reqd': 1}  \n\t\t\t\t],\n\t\t\t\tfunction(values){\n\t\t\t\t\tresolve(values);\n\t\t\t\t},\n\t\t\t\t'Cancelacion de Comprobante',\n\t\t\t\t'Anular'\n\t\t\t\t)\n\t\t\t}).then(function (values){\n\t\t\t\tfrappe.validated = false;\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"nubefact_integration.nubefact_integration.facturacion_electronica.cancel_document\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\t'invoice': frm.docname,\n\t\t\t\t\t\t'doctype': frm.doctype,\n\t\t\t\t\t\t'motivo': values.motivo\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function (data) {\n\t\t\t\t\t\tconsole.log(data)\n\t\t\t\t\t\tfrappe.msgprint(\"<b>Esperando respuesta de SUNAT</b>\", 'Cancelaci\u00f3n');\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t});\n\t\t}\n\t\telse {\n\t\t\tfrappe.validated = false;\n\t\t\tfrappe.msgprint(\"<b>Documento no se puede anular o esta en proceso de anulaci\u00f3n</b>\", 'Cancelaci\u00f3n');\n\t\t}\n\t}\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "UOM", 
  "modified": "2018-11-29 14:51:35.174065", 
  "name": "UOM-Client", 
  "script": "cur_frm.add_fetch('unidad_medida_sunat', 'codigo_unidad_medida', 'codigo_sunat');", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Driver", 
  "modified": "2018-12-24 10:58:16.139227", 
  "name": "Driver-Client", 
  "script": "cur_frm.add_fetch('tipo_documento_identidad', 'codigo_tipo_documento', 'codigo_documento_identidad');", 
  "script_type": "Client"
 }
]